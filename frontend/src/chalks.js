const DEFAULT_CHALK_COLOR = [65, 72, 205];
const DEFAULT_CHALK_TRACE = [
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 0],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 0],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 20],
    [103, 108, 215, 46],
    [217, 218, 245, 62],
    [255, 255, 255, 67],
    [217, 218, 245, 62],
    [103, 108, 215, 46],
    [65, 72, 205, 20],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 41],
    [65, 72, 205, 78],
    [103, 108, 215, 104],
    [217, 218, 245, 119],
    [255, 255, 255, 124],
    [217, 218, 245, 119],
    [103, 108, 215, 104],
    [65, 72, 205, 78],
    [103, 108, 215, 41],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 41],
    [103, 108, 215, 88],
    [65, 72, 205, 124],
    [103, 108, 215, 150],
    [217, 218, 245, 166],
    [255, 255, 255, 171],
    [217, 218, 245, 166],
    [103, 108, 215, 150],
    [65, 72, 205, 124],
    [103, 108, 215, 88],
    [217, 218, 245, 41],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 20],
    [217, 218, 245, 78],
    [103, 108, 215, 124],
    [65, 72, 205, 161],
    [103, 108, 215, 187],
    [217, 218, 245, 202],
    [255, 255, 255, 208],
    [217, 218, 245, 202],
    [103, 108, 215, 187],
    [65, 72, 205, 161],
    [103, 108, 215, 124],
    [217, 218, 245, 78],
    [255, 255, 255, 20],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 46],
    [217, 218, 245, 104],
    [103, 108, 215, 150],
    [65, 72, 205, 187],
    [103, 108, 215, 213],
    [217, 218, 245, 228],
    [255, 255, 255, 234],
    [217, 218, 245, 228],
    [103, 108, 215, 213],
    [65, 72, 205, 187],
    [103, 108, 215, 150],
    [217, 218, 245, 104],
    [255, 255, 255, 46],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 62],
    [217, 218, 245, 119],
    [103, 108, 215, 166],
    [65, 72, 205, 202],
    [103, 108, 215, 228],
    [217, 218, 245, 244],
    [255, 255, 255, 249],
    [217, 218, 245, 244],
    [103, 108, 215, 228],
    [65, 72, 205, 202],
    [103, 108, 215, 166],
    [217, 218, 245, 119],
    [255, 255, 255, 62],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 67],
    [217, 218, 245, 124],
    [103, 108, 215, 171],
    [65, 72, 205, 208],
    [103, 108, 215, 234],
    [217, 218, 245, 249],
    [255, 255, 255, 255],
    [217, 218, 245, 249],
    [103, 108, 215, 234],
    [65, 72, 205, 208],
    [103, 108, 215, 171],
    [217, 218, 245, 124],
    [255, 255, 255, 67],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 62],
    [217, 218, 245, 119],
    [103, 108, 215, 166],
    [65, 72, 205, 202],
    [103, 108, 215, 228],
    [217, 218, 245, 244],
    [255, 255, 255, 249],
    [217, 218, 245, 244],
    [103, 108, 215, 228],
    [65, 72, 205, 202],
    [103, 108, 215, 166],
    [217, 218, 245, 119],
    [255, 255, 255, 62],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 46],
    [217, 218, 245, 104],
    [103, 108, 215, 150],
    [65, 72, 205, 187],
    [103, 108, 215, 213],
    [217, 218, 245, 228],
    [255, 255, 255, 234],
    [217, 218, 245, 228],
    [103, 108, 215, 213],
    [65, 72, 205, 187],
    [103, 108, 215, 150],
    [217, 218, 245, 104],
    [255, 255, 255, 46],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 20],
    [217, 218, 245, 78],
    [103, 108, 215, 124],
    [65, 72, 205, 161],
    [103, 108, 215, 187],
    [217, 218, 245, 202],
    [255, 255, 255, 208],
    [217, 218, 245, 202],
    [103, 108, 215, 187],
    [65, 72, 205, 161],
    [103, 108, 215, 124],
    [217, 218, 245, 78],
    [255, 255, 255, 20],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 41],
    [103, 108, 215, 88],
    [65, 72, 205, 124],
    [103, 108, 215, 150],
    [217, 218, 245, 166],
    [255, 255, 255, 171],
    [217, 218, 245, 166],
    [103, 108, 215, 150],
    [65, 72, 205, 124],
    [103, 108, 215, 88],
    [217, 218, 245, 41],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 41],
    [65, 72, 205, 78],
    [103, 108, 215, 104],
    [217, 218, 245, 119],
    [255, 255, 255, 124],
    [217, 218, 245, 119],
    [103, 108, 215, 104],
    [65, 72, 205, 78],
    [103, 108, 215, 41],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 20],
    [103, 108, 215, 46],
    [217, 218, 245, 62],
    [255, 255, 255, 67],
    [217, 218, 245, 62],
    [103, 108, 215, 46],
    [65, 72, 205, 20],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
  [
    [255, 255, 255, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 0],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [217, 218, 245, 0],
    [103, 108, 215, 0],
    [65, 72, 205, 0],
    [103, 108, 215, 0],
    [217, 218, 245, 0],
    [255, 255, 255, 0],
    [255, 255, 255, 0],
  ],
];

const SOLID_CHALK_TRACE = [
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 20],
    [65, 72, 205, 46],
    [65, 72, 205, 62],
    [65, 72, 205, 67],
    [65, 72, 205, 62],
    [65, 72, 205, 46],
    [65, 72, 205, 20],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 41],
    [65, 72, 205, 78],
    [65, 72, 205, 104],
    [65, 72, 205, 119],
    [65, 72, 205, 124],
    [65, 72, 205, 119],
    [65, 72, 205, 104],
    [65, 72, 205, 78],
    [65, 72, 205, 41],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 41],
    [65, 72, 205, 88],
    [65, 72, 205, 124],
    [65, 72, 205, 150],
    [65, 72, 205, 166],
    [65, 72, 205, 171],
    [65, 72, 205, 166],
    [65, 72, 205, 150],
    [65, 72, 205, 124],
    [65, 72, 205, 88],
    [65, 72, 205, 41],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 20],
    [65, 72, 205, 78],
    [65, 72, 205, 124],
    [65, 72, 205, 161],
    [65, 72, 205, 187],
    [65, 72, 205, 202],
    [65, 72, 205, 208],
    [65, 72, 205, 202],
    [65, 72, 205, 187],
    [65, 72, 205, 161],
    [65, 72, 205, 124],
    [65, 72, 205, 78],
    [65, 72, 205, 20],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 46],
    [65, 72, 205, 104],
    [65, 72, 205, 150],
    [65, 72, 205, 187],
    [65, 72, 205, 213],
    [65, 72, 205, 228],
    [65, 72, 205, 234],
    [65, 72, 205, 228],
    [65, 72, 205, 213],
    [65, 72, 205, 187],
    [65, 72, 205, 150],
    [65, 72, 205, 104],
    [65, 72, 205, 46],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 62],
    [65, 72, 205, 119],
    [65, 72, 205, 166],
    [65, 72, 205, 202],
    [65, 72, 205, 228],
    [65, 72, 205, 244],
    [65, 72, 205, 249],
    [65, 72, 205, 244],
    [65, 72, 205, 228],
    [65, 72, 205, 202],
    [65, 72, 205, 166],
    [65, 72, 205, 119],
    [65, 72, 205, 62],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 67],
    [65, 72, 205, 124],
    [65, 72, 205, 171],
    [65, 72, 205, 208],
    [65, 72, 205, 234],
    [65, 72, 205, 249],
    [65, 72, 205, 255],
    [65, 72, 205, 249],
    [65, 72, 205, 234],
    [65, 72, 205, 208],
    [65, 72, 205, 171],
    [65, 72, 205, 124],
    [65, 72, 205, 67],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 62],
    [65, 72, 205, 119],
    [65, 72, 205, 166],
    [65, 72, 205, 202],
    [65, 72, 205, 228],
    [65, 72, 205, 244],
    [65, 72, 205, 249],
    [65, 72, 205, 244],
    [65, 72, 205, 228],
    [65, 72, 205, 202],
    [65, 72, 205, 166],
    [65, 72, 205, 119],
    [65, 72, 205, 62],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 46],
    [65, 72, 205, 104],
    [65, 72, 205, 150],
    [65, 72, 205, 187],
    [65, 72, 205, 213],
    [65, 72, 205, 228],
    [65, 72, 205, 234],
    [65, 72, 205, 228],
    [65, 72, 205, 213],
    [65, 72, 205, 187],
    [65, 72, 205, 150],
    [65, 72, 205, 104],
    [65, 72, 205, 46],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 20],
    [65, 72, 205, 78],
    [65, 72, 205, 124],
    [65, 72, 205, 161],
    [65, 72, 205, 187],
    [65, 72, 205, 202],
    [65, 72, 205, 208],
    [65, 72, 205, 202],
    [65, 72, 205, 187],
    [65, 72, 205, 161],
    [65, 72, 205, 124],
    [65, 72, 205, 78],
    [65, 72, 205, 20],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 41],
    [65, 72, 205, 88],
    [65, 72, 205, 124],
    [65, 72, 205, 150],
    [65, 72, 205, 166],
    [65, 72, 205, 171],
    [65, 72, 205, 166],
    [65, 72, 205, 150],
    [65, 72, 205, 124],
    [65, 72, 205, 88],
    [65, 72, 205, 41],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 41],
    [65, 72, 205, 78],
    [65, 72, 205, 104],
    [65, 72, 205, 119],
    [65, 72, 205, 124],
    [65, 72, 205, 119],
    [65, 72, 205, 104],
    [65, 72, 205, 78],
    [65, 72, 205, 41],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 20],
    [65, 72, 205, 46],
    [65, 72, 205, 62],
    [65, 72, 205, 67],
    [65, 72, 205, 62],
    [65, 72, 205, 46],
    [65, 72, 205, 20],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
  [
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
    [65, 72, 205, 0],
  ],
];

/// Takes three color components and returns a fourth value that is as similar to the third as the first is similar to the second
/// Without overflowing the rgb boundaries 0-255
function translate(cur, sim, end) {
  if (cur === sim) {
    return end;
  } else if (cur > sim) {
    // sim is guaranteed to not be equal to 255 because one of the other two conditions would have been triggered instead!
    // const diff_ratio = (cur - sim) / (255 - sim)
    return end + Math.floor(((255 - end) * (cur - sim)) / (255 - sim));
  } else {
    // sim is guaranteed to not be equal to zero because one of the above conditions would have been triggered instead!
    // const diff = (sim - cur) / sim;
    return end - Math.ceil((end * (sim - cur)) / sim);
  }
}

class Chalk {
  constructor(design, original) {
    this.design = design;
    this.original = original;
    this.newcolor = original;
  }

  name() {
    return "Chalk";
  }

  changeDesign(newdesign) {
    this.design = newdesign;
  }

  changeColor(newcolor) {
    this.newcolor = newcolor;
  }

  idx(x, y) {
    const [curR, curG, curB, a] = this.design[x][y];
    const [simR, simG, simB] = this.original;
    const [endR, endG, endB] = this.newcolor;

    return [
      translate(curR, simR, endR),
      translate(curG, simG, endG),
      translate(curB, simB, endB),
      a,
    ];
  }

  idx_ptr(x, y) {
    const [r, g, b, a] = this.idx(x, y);
    return [r, g, b, Math.floor(0.8 * a)];
  }

  sizeX() {
    return this.design.length;
  }

  sizeY() {
    return this.design[0].length;
  }
}

export function createChalk(design, color) {
  return new Chalk(design, color);
}

export const DefaultChalk = new Chalk(DEFAULT_CHALK_TRACE, DEFAULT_CHALK_COLOR);

export const COLORS = [
  [65, 72, 205],
  [240, 25, 100],
  [0, 64, 64],
  [165, 75, 165],
  [255, 127, 50],
  [255, 255, 255],
];
export const DESIGNS = [DEFAULT_CHALK_TRACE, SOLID_CHALK_TRACE];
